# Брокеры сообщений и асинхронные задачи

## Celery vs FastAPI BackgroundTasks

|                        | Celery                              | BackgroundTasks                 |
| ---------------------- | ----------------------------------- | ------------------------------- |
| **Назначение**         | Распределённая очередь задач        | Внутрипроцессные фоновые задачи |
| **Производительность** | Подходит для тяжёлых нагрузок       | Только для лёгких операций      |
| **Перезапуск задач**   | Есть (автоматический)               | Нет (пропадут при рестарте)     |
| **Где использовать**   | Отправка 1000+ писем, PDF-генерация | Логирование, нотификации        |

## Брокеры сообщений

### Redis

- **Тип**: In-memory key-value хранилище (+ pub/sub)
- **Плюсы**: 
  - Очень быстрый (100k+ операций/сек)
  - Подходит для кэша и простых очередей
- **Минусы**: 
  - Нет persistence по умолчанию
  - Нет сложной маршрутизации

### RabbitMQ

- **Тип**: Специализированный брокер (AMQP)
- **Плюсы**:
  - Гарантированная доставка
  - Поддержка сложных топологий (exchange/routing)
- **Минусы**: 
  - Медленнее Redis (~20k сообщений/сек)

### Kafka

- **Тип**: Распределённый event log
- **Ключевые особенности**:
  - Хранение сообщений долгое время
  - Потоковая обработка (не только очереди)
  - Горизонтальное масштабирование
- **Использование**: Аналитика, аудит логов, event sourcing

## Когда что использовать?

1. **Celery + Redis**:
   
   - Быстрые фоновые задачи (до 100k задач/час)
   - Пример: нотификации, обработка изображений

2. **Celery + RabbitMQ**:
   
   - Критичные задачи (платёжные операции)
   - Сложная маршрутизация (priority queues)

3. **Kafka**:
   
   - Обработка потоковых данных (трекинг действий)
   - Микросервисная архитектура
